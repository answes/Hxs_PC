
<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">	<meta name="description" content="">
    <title>包含成交量的蜡烛图</title>
    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/highstock.js"></script>
    <script src="../js/exporting.js"></script>
</head>
<body style="margin: 0px">
<div id="container" style="min-width:400px;height:400px">图表加载中...</div>

<script>
    var root =  document.getElementById('container');
    var width = document.documentElement.clientWidth;
    var hight = document.documentElement.clientHeight;
    root .style.width = width+"px";
    root.style.height = hight+"px";
    $(function () {
        //数据来源 上海证券交易所
        $.getJSON('https://data.jianshukeji.com/jsonp?url=http://yunhq.sse.com.cn:32041/v1/sh1/dayk/000001&callback=?',function(data){
            // split the data set into ohlc and volume
            var ohlc = [],
                volume = [],
                maset = [5,10,20,30],
                ma = [],
                dataLength = data.kline.length,
                i = 0;
            for (i; i < dataLength; i += 1) {
                //时间
                var newdate = data.kline[i][0].toString();
                var myDate = new Date(newdate.substring(0,4)+'-'+newdate.substring(4,6)+'-'+newdate.substring(6)+' 00:00:00');
                xAxisDate = myDate.getTime();
                //            console.log(xAxisDate);
                ohlc.push([
                    // data.kline[i][0], // the date
                    xAxisDate,
                    data.kline[i][1], // open
                    data.kline[i][2], // high
                    data.kline[i][3], // low
                    data.kline[i][4] // close
                ]);
                $.each(maset,function(index,value){
                    // console.log(index,value);
                    if(typeof ma['ma'+value] == "undefined"){
                        ma['ma'+value]=[];
                    }
                    if(typeof ma[value+'total'] == "undefined"){
                        ma[value+'total']=0;
                    }
                    if(i<value)
                    {
                        ma[value+'total'] += data.kline[i][4];
                        ma['ma'+value].push([xAxisDate,null]);
                    } else {
                        ma[value+'total'] += (data.kline[i][4] - data.kline[i-value][4]);
                        ma['ma'+value].push([xAxisDate, ma[value+'total']/value]);
                    }
                });
                var newColor = data.kline[i][4]>data.kline[i][1]?'#a80000':'#00a800';
                volume.push({x: xAxisDate,
                    y: data.kline[i][5],
                    color: newColor
                });
            }
            //console.log(ma);
//            //导入选项
//            Highcharts.setOptions(Highcharts.option);
//            //导入主题
//            Highcharts.setOptions(Highcharts.theme);
            $('#container').highcharts('StockChart', {
                rangeSelector: {
                    enabled: false
                },
                exporting: {  					 //  	输出功能，需搭建 export server 暂时关闭
                    enabled: false	,
                },
                legend:{enabled:false},
                title: {
                    style: {
                        color: '#dd54fc',
                        fontWeight: 'bold'
                    },
                    text: data.code+" 上证指数"
                },
                chart: {
                    //renderTo:'container',
                },
                navigator: {
                    enabled: true, //false
                    margin: 2,
                    height: 17
                },
                xAxis: {
                    startOnTick: false,//true,//
                    endOnTick:true,
                    minPadding:0,
                    maxPadding:0,
                    ordinal: true //false
                },
                yAxis: [{
                    minorTickInterval: 'auto',
                    showLastLabel: true,
                    showFirstLabel: false,
                    labels: {
                        style:
                            {"color":"#FCFFa5","fontWeight":"bold"},
                        align: 'right',
                        x: -3
                    },
                    title: 'ohlc',
                    height: '61.8%',
                    lineWidth: 0,
                    opposite: false //true,
                },
                    {
                        minorTickInterval: 'auto',
                        labels: {
                            style:
                                {"color":"#FCFFa5","fontWeight":"bold"},
                            align: 'right',
                            x: -3
                        },
                        title: {
                            text: ''
                        },
                        /*Volume*/
                        top: '61.8%',
                        height: '38.2%',
                        offset: 0,
                        lineWidth: 0,
                        opposite: false
                    }],
                series: [{
                    type:'candlestick',
                    name:'价',
                    data: ohlc,
                    dataGrouping: {
                        enables:false
                    },
                    yAxis: 0,
                    id:'c'
                },{
                    type:'line',
                    name:'ma5' ,
                    data: ma['ma5'] ,
                    color: "#fcfc54",
                    yAxis: 0
                },{
                    type:'line',
                    name:'ma10' ,
                    data: ma['ma10'] ,
                    color: "#dd54fc",
                    yAxis: 0
                },{
                    type:'line',
                    name:'ma20' ,
                    data: ma['ma20'] ,
                    color: "#54fc54",
                    yAxis: 0
                },{
                    type:'line',
                    name:'ma30' ,
                    data: ma['ma30'] ,
                    color: "#3f54fc",
                    yAxis: 0
                },
                    {
                        animation: false,
                        type: 'column',
                        //pointWidth: 3,
                        name: '量',
                        data: volume,
                        dataGrouping: {
                            enables:false
                        },
                        yAxis: 1
                    }]
            },function(c){
                var _credits = c.options.credits;
                c.credits.on("click",function(){
                    if(_credits.enabled && _credits.href){
                        //多选或者更多功能、样式，建议使用Model
                        if(window.confirm('将要访问 hcharts.cn?')) {
                            window.open(_credits.href);
                        } else {
                            // back
                        }
                    }
                });
            });
        } );
    });
</script>

</body></html>